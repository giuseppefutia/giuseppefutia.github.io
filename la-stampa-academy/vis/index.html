
<!DOCTYPE html>
<html class="ocks-org do-not-copy">
<meta charset="utf-8">
<title>La Stampa Academy Project</title>
<style>

@import url(css/style.css);

.node rect {
  cursor: move;
  fill-opacity: .9;
  shape-rendering: crispEdges;
}

.node text {
  pointer-events: none;
  text-shadow: 0 1px 0 #fff;
}

.link {
  fill: none;
  stroke: #000;
  stroke-opacity: .2;
}

.link:hover {
  stroke-opacity: .5;
}

#barchart {
  position: absolute;
  top: 120px;
  left: 550px;
}

#genderUnemplBar rect {
  fill: steelblue;
  stroke: white;
}

#genderAbandonBar rect {
  fill: steelblue;
  stroke: white;
}

div.tooltip {
  color: #222; 
  background: #fff; 
  padding: .5em; 
  text-shadow: #f5f5f5 0 1px 0;
  border-radius: 2px; 
  box-shadow: 0px 0px 2px 0px #a6a6a6; 
  opacity: 0.9; 
  position: absolute;
}

.hidden { 
  display: none; 
}


</style>
<body>

<header>
  <aside>Updated Mar 18, 2014</aside>
  <a href="http://it.linkedin.com/in/giuseppefutia" rel="author">Giuseppe Futia</a>
</header>

<h1>La Stampa Academy</h1>

<p>Descrizione del progetto</p>

<p id="map">
<p id="barchart">
<div id="container" class="container">
    <header>
    <h2>Spesa pubblica per consumi finali per l'istruzione e la formazione per regione</h2>
    </header>
    <div id="main" role="main">
      <p>La spesa in istruzione e formazione, misurata in rapporto al prodotto interno lordo, rappresenta uno degli indicatori chiave per valutare le policy attuate in materia di crescita e valorizzazione del capitale umano. L’indicatore consente di quantificare, a livello nazionale e internazionale, quanto i paesi spendono per migliorare le strutture e incentivare insegnanti e studenti a partecipare ai percorsi formativi. In Italia nel 2011 l’incidenza della spesa pubblica in istruzione e formazione sul prodotto interno lordo è pari al 4,2 per cento (<a href="http://noi-italia.istat.it/index.php?id=7&L=0&user_100ind_pi1%5Bid_pagina%5D=33&cHash=940c9f597e568c69a9f7978a8e7ab97c">noi-italia.istat.it</a>).</p>
      <div id="view_selection" class="btn-group">
        <a href="#" id="all" class="btn active">All Grants</a>
        <a href="#" id="year" class="btn">Grants By Year</a>
      </div>
      <div id="vis"></div>
    </div>
  </div>

<footer>
  <aside>Updated Mar 18, 2014</aside>
  <a href="http://bost.ocks.org/mike/" rel="author"> Website style by Mike Bostock</a>
</footer>

<script>window.jQuery || document.write('<script src="js/libs/jquery-1.6.2.min.js"><\/script>')</script>

<!-- To work locally --> 
<!--<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="http://d3js.org/queue.v1.min.js" charset="utf-8"></script>
<script defer src="js/plugins.js"></script>
<script defer src="js/script.js"></script>
<script src="js/CustomTooltip.js"></script>
<script src="js/libs/coffee-script.js"></script>
<script src="js/libs/d3.csv.min.js"></script>
<script src="js/libs/d3.layout.min.js"></script>
<script src="js/libs/d3.geom.min.js"></script>
<script type="text/coffeescript" src="coffee/vis.coffee"></script>-->

<!-- To work on github -->

<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="http://d3js.org/queue.v1.min.js" charset="utf-8"></script>
<script defer src="http://giuseppefutia.github.io/la-stampa-academy/vis/js/plugins.js"></script>
<script defer src="http://giuseppefutia.github.io/la-stampa-academy/vis/js/script.js"></script>
<script src="http://giuseppefutia.github.io/la-stampa-academy/vis/js/CustomTooltip.js"></script>
<script src="http://giuseppefutia.github.io/la-stampa-academy/vis/js/libs/coffee-script.js"></script>
<script src="http://giuseppefutia.github.io/la-stampa-academy/vis/js/libs/d3.csv.min.js"></script>
<script src="http://giuseppefutia.github.io/la-stampa-academy/vis/js/libs/d3.layout.min.js"></script>
<script src="http://giuseppefutia.github.io/la-stampa-academy/vis/js/libs/d3.geom.min.js"></script>
<script type="text/coffeescript" src="http://giuseppefutia.github.io/la-stampa-academy/vis/coffee/vis.coffee"></script>









<script>
 $(document).ready(function() {
        $(document).ready(function() {
          $('#view_selection a').click(function() {
            var view_type = $(this).attr('id');
            $('#view_selection a').removeClass('active');
            $(this).toggleClass('active');
            toggle_view(view_type);
            return false;
          });
        });
    });

var margin = {top: 1, right: 1, bottom: 6, left: 1},
    width = 1024 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;
    firstRegionClicked = false;
    secondRegionClicked = false;
    tooltip = undefined;
    //color = d3.scale.category20c();
    //outerRadius = 120;
    //innerRadius = outerRadius * .6;

//d3.select("#chart").attr("height", height);

var svgRegionMap = {
  "g_reg20": "Sardegna",
  "g_reg10": "Basilicata"
}

var regionSvgMap = {
  "Sardegna": "g_reg20",
  "Basilicata": "g_reg10"
}

queue()
    .defer(d3.xml, "http://giuseppefutia.github.io/la-stampa-academy/vis/italia_regioni.svg")
    .defer(d3.json, "http://giuseppefutia.github.io/la-stampa-academy/vis/data/tasso-disoccupazione-regione.json")
    .await(ready);

function ready (error, regions, unemplRegions) {
    document.getElementById("map").appendChild(regions.documentElement);
    var svgMap = d3.select("#map").select("svg").attr("width", "600");
    svgMap.attr("height", "500");
    
    var geoMap = d3.select("#global");
    geoMap.attr("transform", "scale(0.7)");
    
    var ur = urObjectForD3(unemplRegions);
  
    visualizeMap(geoMap, ur);
    
    var barchart = d3.select("#barchart")
        .append("svg")
    
    barchart.append("g")    
        .attr("id", "genderUnemplBar")
        .selectAll("rect")
        .data([0,0]) 
        .enter().append("rect") 
        .attr("height", 0)

    barchart.append("g")   
        .attr("id", "genderAbandonBar")
        .attr("transform", "translate(0,200)")
        .selectAll("rect")
        .data([0,0]) 
        .enter().append("rect") 
        .attr("height", 0)
    
    barchart.append("g")    
        .attr("id", "genderNeetBar")
        .selectAll("rect")
        .data([0,0]) 
        .enter().append("rect") 
        .attr("height", 0)  
    
    tooltip = d3.select("#map").append("div")
        .attr("class", "tooltip");  
}

function urObjectForD3 (json) {
    var objectResult = new Object();
    for (var i = 0; i <json.length; i++) {
        var region = json[i]["cell"][0]["$t"];
        var value = json[i]["cell"][1]["$t"];
        objectResult[region] = value;
    }
    return objectResult;
}

function visualizeMap (geoMap, unemplRegions) {
    var scale = d3.scale.linear() .domain([0, 60]).range([0 , 1]);
    geoMap.selectAll("g")
         .style("fill", "orange")
    
    for (var id in svgRegionMap) {
          //TODO: anziché passare un array di tanti elementi, passa un array di un solo elemento con tanti oggetti 
          d3.select("#"+id).datum([svgRegionMap[id], unemplRegions[svgRegionMap[id]]])
             .style("opacity", function (d, i) {
                  return scale(d[1]);
              })
              .on("mousemove", function (d ,i) {
                  var svg = d3.select('svg')
                  var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );

                  tooltip
                      .classed("hidden", false)
                      .attr("style", "left:"+(mouse[0]+25)+"px;top:"+(mouse[1]+200)+"px")
                      .html("<strong>" +d[0]+ "</strong></br>Disoccupazione giovanile: " + d[1] + "%")
                  
                  d3.select("#"+regionSvgMap[d[0]]).style("fill", "green");
                  
                  moveOnRegion(d);
              
              })
              .on("mouseout", function (d, i) {
                  tooltip.classed("hidden", true);
                  d3.select("#"+regionSvgMap[d[0]]).style("fill", "orange");
                  moveOutRegion(d);
              })
              .on("click", function (d,i) {
                var region = d3.select("#"+regionSvgMap[d[0]]);
                


                if(region.classed("firstClicked") == true) {
                  region.classed("firstClicked", false);
                }
                




                //if()
                //d3.select("#"+regionSvgMap[d[0]]).classed("firstClicked", true);

              })
    }  

}

function moveOnRegion (data) {

    var dataproof = [10,100]

    var w = 20,
        h = 150;
 
    var x = d3.scale.linear()
        .domain([0, 1])
        .range([0, w]);
 
    var y = d3.scale.linear()
       .domain([0, 100])
       .rangeRound([0, h]);
    
    var unemplBarChart = d3.select("#barchart")
        .style("position", "absolute")
        .style("top", "120px")
        .style("left", "550px")
        .select('#genderUnemplBar')
        .attr("width", w * 2)
        .attr("height", h)
    
    unemplBarChart.selectAll("rect")
        .data(dataproof) 
        .transition()
        .duration(500)
        .attr("x", function(d, i) { return x(i) -  .5; })
        .attr("y", function(d) { return h - y(d) - .5; })
        .attr("width", w)
        .attr("height", function(d) { return y(d); })

    var abandonBarChart = d3.select('#genderAbandonBar')
        .attr("width", w * 2)
        .attr("height", h)
    
    abandonBarChart.selectAll("rect")
        .data(dataproof) 
        .transition()
        .duration(500)
        .attr("x", function(d, i) { return x(i) -  .5; })
        .attr("y", function(d) { return h - y(d) - .5; })
        .attr("width", w)
        .attr("height", function(d) { return y(d); })

   
}

function moveOutRegion (data) {
    var w = 20,
        h = 150;
 
    var x = d3.scale.linear()
        .domain([0, 1])
        .range([0, w]);
 
    var y = d3.scale.linear()
       .domain([0, 100])
       .rangeRound([0, h]); 

    var unemplBarChart = d3.select("#barchart").select('#genderUnemplBar')
    unemplBarChart.selectAll('rect')
    .data([0,0]) 
    .transition()
    .duration(500)
    .attr("y", function(d) { return h - y(d) - .5; })
    .attr("height", function (d) { return d;});

    var abandonBarChart = d3.select("#barchart").select('#genderAbandonBar')
    abandonBarChart.selectAll('rect')
    .data([0,0]) 
    .transition()
    .duration(500)
    .attr("y", function(d) { return h - y(d) - .5; })
    .attr("height", function (d) { return d;});  


}

function updateMap() {

}

function createAreaCircles() {
  //Codice ripartizione Regioni e Province
}







/*
var skills = [
              { "key": "Press Office", "value": 70 },
              { "key": "Social Media", "value": 50 },
              { "key": "Linked Data", "value": 20 },
              { "key": "Data Visualization", "value": 30 },
              { "key": "Content Management", "value": 60 },
              { "key": "Cloud Computing", "value": 10 },
              { "key": "Journalism", "value" : 60 }
             ];

var arc = d3.svg.arc()
          .outerRadius(outerRadius)
          .innerRadius(innerRadius);

var pie = d3.layout.pie()
           .sort(null)
           .value(function(d) {
            return d.value; }
          );

var svg = d3.select("#chart").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    
    
var arcs = svg.selectAll("g.slice")
    .data(pie(skills))
    .enter()
        .append("g")
        .attr("transform", "translate(" + (width/2 - outerRadius) + "," + (outerRadius+50)  + ")")
        .attr("class", "slice");

    arcs.append("path")    
        .attr("fill", function(d, i) { return color(i); } )
        .attr("d", arc)
        .transition()
          .ease("bounce")
          .duration(2500)
          .attrTween("d", tweenPie)

    arcs.append("text")
       .attr("font-family", "PT Serif")
       .attr("font-size", "medium")
       .transition()
       .delay(2700)
       .ease("elastic")
          .duration(2700)
       .attr("fill", "#333")                  
       .attr("transform", function(d) {                    
            var c = arc.centroid(d),
            x = c[0],
            y = c[1],
            // pythagorean theorem for hypotenuse
            h = Math.sqrt(x*x + y*y);
            return "translate(" + (x/h * 140) +  ',' +
                                  (y/h * 140) +  ")";   
            })
        .attr("text-anchor", function(d) {
            return (d.endAngle + d.startAngle)/2 > Math.PI ?
            "end" : "start";
        })                       
        .text(function(d, i) { return skills[i].key; });

function tweenPie(b){
    b.innerRadius = 0;
    var i = d3.interpolate({startAngle:0, endAngle:0}, b);
    return function(t) { return arc(i(t)); };
  }

function tweenDonut(b){
    b.innerRadius = 90 * .6;
    var i = d3.interpolate({innerRadius:0},b);
    return function(t) { return arc(i(t)); };
  }

  */ 

</script>