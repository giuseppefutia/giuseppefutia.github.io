
<!DOCTYPE html>
<html class="ocks-org do-not-copy">
<meta charset="utf-8">
<title>La Stampa Academy Project</title>
<style>

@import url(css/style.css);

.node rect {
  cursor: move;
  fill-opacity: .9;
  shape-rendering: crispEdges;
}

.node text {
  pointer-events: none;
  text-shadow: 0 1px 0 #fff;
}

.link {
  fill: none;
  stroke: #000;
  stroke-opacity: .2;
}

.link:hover {
  stroke-opacity: .5;
}

#barchart {
  position: absolute;
  top: 150px;
  left: 600px;
  height: 800px;
}

div.tooltip {
  color: #222; 
  background: #fff; 
  padding: .5em; 
  text-shadow: #f5f5f5 0 1px 0;
  border-radius: 2px; 
  box-shadow: 0px 0px 2px 0px #a6a6a6; 
  opacity: 0.9; 
  position: absolute;
}

.hidden { 
  display: none; 
}

.titleText {
  font-family: "PT Serif";
  font-size: 15px;
  fill: #333;
}


</style>
<body>

<header>
  <aside>Updated Mar 18, 2014</aside>
  <a href="http://it.linkedin.com/in/giuseppefutia" rel="author">Giuseppe Futia</a>
</header>

<h1>La Stampa Academy</h1>
<header>
<h2>Qual Ã¨ la correlazione tra disoccupazione giovanile, tasso di abbandono degli studi, tasso di sfiducia da parte dei giovani, che comprende coloro che non studiano e non lavorano? </h2>
</header>

<p id="map">
<p id="barchart">
<div id="container" class="container">
    <header>
    <h2>Spesa pubblica per consumi finali per l'istruzione e la formazione per regione</h2>
    </header>
    <div id="main" role="main">
      <div id="view_selection" class="btn-group">
        <a href="#" id="all" class="btn active">Visualizzazione aggregata</a>&nbsp;&nbsp;&nbsp;&nbsp;
        <a href="#" id="year" class="btn">Visualizzazione per area geografica</a>
      </div>
      <div id="vis"></div>
    </div>
  </div>

<footer>
  <aside>Updated Mar 18, 2014</aside>
  <a href="http://bost.ocks.org/mike/" rel="author"> Website style by Mike Bostock</a>
</footer>

<script>window.jQuery || document.write('<script src="js/libs/jquery-1.6.2.min.js"><\/script>')</script>

<!-- To work locally --> 
<!--<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="http://d3js.org/queue.v1.min.js" charset="utf-8"></script>
<script defer src="js/plugins.js"></script>
<script defer src="js/script.js"></script>
<script src="js/CustomTooltip.js"></script>
<script src="js/libs/coffee-script.js"></script>
<script src="js/libs/d3.csv.min.js"></script>
<script src="js/libs/d3.layout.min.js"></script>
<script src="js/libs/d3.geom.min.js"></script>
<script src="coffee/vis.js"></script>-->

<!-- To work on github pages -->

<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="http://d3js.org/queue.v1.min.js" charset="utf-8"></script>
<script defer src="http://giuseppefutia.github.io/la-stampa-academy/vis/js/plugins.js"></script>
<script defer src="http://giuseppefutia.github.io/la-stampa-academy/vis/js/script.js"></script>
<script src="http://giuseppefutia.github.io/la-stampa-academy/vis/js/CustomTooltip.js"></script>
<script src="http://giuseppefutia.github.io/la-stampa-academy/vis/js/libs/coffee-script.js"></script>
<script src="http://giuseppefutia.github.io/la-stampa-academy/vis/js/libs/d3.csv.min.js"></script>
<script src="http://giuseppefutia.github.io/la-stampa-academy/vis/js/libs/d3.layout.min.js"></script>
<script src="http://giuseppefutia.github.io/la-stampa-academy/vis/js/libs/d3.geom.min.js"></script>
<script src="http://giuseppefutia.github.io/la-stampa-academy/vis/coffee/vis.js"></script>

<script>

var margin = {top: 1, right: 1, bottom: 6, left: 1},
    width = 1024 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;
    //firstRegionClicked = false;
    //secondRegionClicked = false;
    tooltip = undefined;
    tooltipBar = undefined;
    //color = d3.scale.category20c();
    //outerRadius = 120;
    //innerRadius = outerRadius * .6;

//d3.select("#chart").attr("height", height);

var svgRegionMap = {
  "g_reg20": "Sardegna",
  "g_reg17": "Basilicata",
  "g_reg3": "Lombardia",
  "g_reg10": "Umbria",
  "g_reg16": "Puglia",
  "g_reg15": "Campania",
  "g_reg6": "Friuli-Venezia Giulia",
  "g_reg19": "Sicilia",
  "g_reg1": "Piemonte",
  "g_reg18": "Calabria",
  "g_reg5": "Veneto",
  "g_reg12": "Lazio",
  "g_reg9": "Toscana",
  "g_reg13": "Abruzzo",
  "g_reg14": "Molise",
  "g_reg8": "Emilia-Romagna",
  "g_reg7": "Liguria",
  "g_reg11": "Marche",
  "g_reg4": "Trentino-Alto Adige",
  "g_reg2": "Valle d'Aosta"

}

var regionSvgMap = {
  "Sardegna": "g_reg20",
  "Basilicata": "g_reg17",
  "Lombardia": "g_reg3",
  "Umbria": "g_reg10",
  "Puglia": "g_reg16",
  "Friuli-Venezia Giulia": "g_reg6",
  "Sicilia": "g_reg19",
  "Piemonte": "g_reg1",
  "Veneto": "g_reg5",
  "Lazio": "g_reg12",
  "Toscana": "g_reg9",
  "Abruzzo": "g_reg13",
  "Calabria": "g_reg18",
  "Campania": "g_reg15",
  "Molise": "g_reg14",
  "Liguria": "g_reg7",
  "Emilia-Romagna": "g_reg8",
  "Marche": "g_reg11",
  "Trentino-Alto Adige": "g_reg4",
  "Valle d'Aosta": "g_reg2"
}


// To work on GitHub Pages
queue()
    .defer(d3.xml, "http://giuseppefutia.github.io/la-stampa-academy/vis//italia_regioni.svg")
    .defer(d3.json, "http://giuseppefutia.github.io/la-stampa-academy/vis//data/tasso-disoccupazione-regione.json")
    .defer(d3.json, "http://giuseppefutia.github.io/la-stampa-academy/vis//data/tasso-disoccupazione-regione-M-F.json")
    .defer(d3.json, "http://giuseppefutia.github.io/la-stampa-academy/vis//data/abbandono-neet-regione-M-F.json")
    .await(ready); 

//To work locally
/*queue()
    .defer(d3.xml, "/italia_regioni.svg")
    .defer(d3.json, "/data/tasso-disoccupazione-regione.json")
    .defer(d3.json, "/data/tasso-disoccupazione-regione-M-F.json")
    .defer(d3.json, "/data/abbandono-neet-regione-M-F.json")
    .await(ready);*/

function ready (error, regions, unemplRegions, unemplRegionsMF, abandonNeetRegionsMF) {
    document.getElementById("map").appendChild(regions.documentElement);
    var svgMap = d3.select("#map").select("svg").attr("width", "600");
    svgMap.attr("height", "500");
    
    var geoMap = d3.select("#global");
    geoMap.attr("transform", "scale(0.7)");
    
    var ur = urObjectForD3(unemplRegions);
    var urmf = urmfObjectForD3(unemplRegionsMF);
    var anrmf = anrmfObjectForD3(abandonNeetRegionsMF);
  
    visualizeMap(geoMap, ur, urmf, anrmf);

    $('#view_selection a').click(function() {
        var view_type = $(this).attr('id');
        $('#view_selection a').removeClass('active');
        $(this).toggleClass('active');
        toggle_view(view_type);
        return false;
    });
    
    var barchart = d3.select("#barchart").append("svg")
    generateFirstRegionBars();
    
    tooltip = d3.select("#map").append("div")
        .attr("class", "tooltip hidden");  
}

function urObjectForD3 (json) {
    var objectResult = new Object();
    for (var i = 0; i <json.length; i++) {
        var region = json[i]["cell"][0]["$t"];
        var value = json[i]["cell"][1]["$t"];
        objectResult[region] = value;
    }
    return objectResult;
}

function urmfObjectForD3 (json) {
    var objectResult = new Object();
    for (var i = 0; i <json.length; i++) {
        var region = json[i]["cell"][0]["$t"];
        var men = json[i]["cell"][1]["$t"];
        var women = json[i]["cell"][2]["$t"];
        objectResult[region] = {"men": men, "women": women};
    }
    return objectResult;
}

function anrmfObjectForD3 (json) {
    var objectResult = new Object();
    for (var i = 0; i <json.length; i++) {
        var region = json[i]["cell"][0]["$t"];
        var abandon = json[i]["cell"][1]["$t"];
        var abandonMen = json[i]["cell"][2]["$t"];
        var abandonWomen = json[i]["cell"][3]["$t"];
        var neet = json[i]["cell"][4]["$t"];
        var neetMen = json[i]["cell"][5]["$t"];
        var neetWomen = json[i]["cell"][6]["$t"];
        objectResult[region] = {"abandon": abandon,
                                "abandonMen": abandonMen,
                                "abandonWomen": abandonWomen,
                                "neet": neet,
                                "neetMen": neetMen,
                                "neetWomen": neetWomen
                              };
    }
    return objectResult;
}

function visualizeMap (geoMap, unemplRegions, unemplRegionsMF, abandonNeetRegionsMF) {
  // Tienine conto per la gestione del form
    var scale = d3.scale.linear().domain([0, 60]).range([0 , 1]);
    geoMap.selectAll("g")
         .style("fill", "orange")
    
    for (var id in svgRegionMap) {
          var dataObject = {"id": svgRegionMap[id],
                            "unemployment": unemplRegions[svgRegionMap[id]],
                            "unemplMen": unemplRegionsMF[svgRegionMap[id]]["men"],
                            "unemplWomen": unemplRegionsMF[svgRegionMap[id]]["women"],
                            "abandon": abandonNeetRegionsMF[svgRegionMap[id]]["abandon"],
                            "abandonMen": abandonNeetRegionsMF[svgRegionMap[id]]["abandonMen"],
                            "abandonWomen": abandonNeetRegionsMF[svgRegionMap[id]]["abandonWomen"],
                            "neet": abandonNeetRegionsMF[svgRegionMap[id]]["neet"],
                            "neetMen": abandonNeetRegionsMF[svgRegionMap[id]]["neetMen"],
                            "neetWomen": abandonNeetRegionsMF[svgRegionMap[id]]["neetWomen"]
                          };               
          console.info(dataObject);
          d3.select("#"+id).datum([dataObject])
             .style("opacity", function (d, i) {
                  return scale(d[0].unemployment);
              })
              .on("mousemove", function (d ,i) {
                  var svg = d3.select('svg')
                  var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );

                  tooltip
                      .classed("hidden", false)
                      .attr("style", "left:"+(mouse[0])+"px;top:"+(mouse[1]+300)+"px")
                      .html("<strong>" +d[0].id+ "</strong></br>Disoccupazione giovanile: " + d[0].unemployment + "%")
                  
                  d3.select("#"+regionSvgMap[d[0].id]).style("fill", "green");
              })
              .on("mouseout", function (d, i) {
                  tooltip.classed("hidden", true);
                  d3.select("#"+regionSvgMap[d[0].id]).style("fill", "orange");
                  //moveOutRegion(d);
              })
              .on("click", function (d,i) {
                var region = d3.select("#"+regionSvgMap[d[0].id]);
                mouseClickRegion(d);

              })
    }  

}

function generateFirstRegionBars () {
  var barchart = d3.select("#barchart").select('svg')
  tooltipBar = d3.select("#barchart").append("div")
        .attr("class", "tooltip hidden");
  
  //Gender Region Unemployment Bar
  barchart.append("g")    
        .attr("id", "genderRegionUnemplBar")
        .attr("transform","translate(20,80)")
        .append("text")
        .text("Tasso di disoccupazione giovanile")
        .attr("class", "titleText")
        .attr("x", 0)
        .attr("y", 15)

  barchart.select("#genderRegionUnemplBar")
        .append("text")   
        .text("nel 2012 per regione (15-24 anni) M/F")   
        .attr("class", "titleText")
        .attr("fill", "#333")
        .attr("x", -10)
        .attr("y", 35)
  
    barchart.select("#genderRegionUnemplBar")   
        .selectAll("rect")
        .data([0,0]) 
        .enter().append("rect")
        .attr("transform", "translate(90, 50)")    
        .attr("width", 0)
        .attr("fill", function (d,i) {
            if(i == 0)
                return "pink";
            if(i == 1)
                return "steelblue"
        })
        .on("mousemove", function (d,i) {
            var mouse = d3.mouse(barchart.node()).map( function(d) { return parseInt(d); } );
            var sex = "femminile"
            if(i == 1) sex = "maschile"
            tooltipBar
                .classed("hidden", false)
                .attr("style", "left:"+(mouse[0]+20)+"px;top:"+(mouse[1]+20)+"px")
                .html("<strong>" + d.id + "</strong><br>Disoccupazione " +sex+ ": <strong>" + d.sex + "%</strong><br>Disoccupazione media: <strong>" + d.unemployment +"%</strong>" )
        })
        .on("mouseout", function (d, i) {
            tooltipBar.classed("hidden", true);
                  
        })
    
    //Gender Abandon Bar

    barchart.append("g")    
        .attr("id", "genderRegionAbandonBar")
        .attr("transform","translate(20,80)")
        .append("text")
        .text("Giovani che abbandonano gli studi")
        .attr("class", "titleText")
        .attr("x", 0)
        .attr("y", 195)

    barchart.select("#genderRegionAbandonBar")
        .append("text")   
        .text("nel 2012 per regione M/F")   
        .attr("class", "titleText")
        .attr("fill", "#333")
        .attr("x", 30)
        .attr("y", 215)
  
    barchart.select("#genderRegionAbandonBar")   
        .selectAll("rect")
        .data([0,0]) 
        .enter().append("rect")
        .attr("transform", "translate(90, 230)")    
        .attr("width", 0)
        .attr("fill", function (d,i) {
            if(i == 0)
                return "pink";
            if(i == 1)
                return "steelblue"
        })
        .on("mousemove", function (d,i) {
            var mouse = d3.mouse(barchart.node()).map( function(d) { return parseInt(d); } );
            var sex = "femminile"
            if(i == 1) sex = "maschile"
            tooltipBar
                .classed("hidden", false)
                .attr("style", "left:"+(mouse[0]+20)+"px;top:"+(mouse[1]+20)+"px")
                .html("<strong>" + d.id + "</strong><br>Abbandono " +sex+ ": <strong>" + d.sex + "%</strong><br>Abbandono medio: <strong>" + d.unemployment +"%</strong>" )
        })
        .on("mouseout", function (d, i) {
            tooltipBar.classed("hidden", true);                  
        })


    //Gender Neet Bar

    barchart.append("g")    
        .attr("id", "genderRegionNeetBar")
        .attr("transform","translate(20,80)")
        .append("text")
        .text("Giovani che non lavorano e non studiano")
        .attr("class", "titleText")
        .attr("x", -10)
        .attr("y", 375)

    barchart.select("#genderRegionNeetBar")
        .append("text")   
        .text("(Neet) nel 2012 per regione (15-29 anni) M/F")  
        .attr("class", "titleText")
        .attr("fill", "#333")
        .attr("x", -20)
        .attr("y", 395)
  
    barchart.select("#genderRegionNeetBar")   
        .selectAll("rect")
        .data([0,0]) 
        .enter().append("rect")
        .attr("transform", "translate(90, 410)")    
        .attr("width", 0)
        .attr("fill", function (d,i) {
            if(i == 0)
                return "pink";
            if(i == 1)
                return "steelblue"
        })
        .on("mousemove", function (d,i) {
            var mouse = d3.mouse(barchart.node()).map( function(d) { return parseInt(d); } );
            var sex = "femminile"
            if(i == 1) sex = "maschile"
            tooltipBar
                .classed("hidden", false)
                .attr("style", "left:"+(mouse[0]+20)+"px;top:"+(mouse[1]+20)+"px")
                .html("<strong>" + d.id + "</strong><br>Neet " +sex+ ": <strong>" + d.sex + "%</strong><br>Neet medio: <strong>" + d.unemployment +"%</strong>" )
        })
        .on("mouseout", function (d, i) {
            tooltipBar.classed("hidden", true);                  
        })
}

function mouseClickRegion (data) {
    var dataforUnemplBars = [{"id": data[0].id, "unemployment": data[0].unemployment, "sex": data[0].unemplWomen }, {"id": data[0].id, "unemployment": data[0].unemployment,"sex": data[0].unemplMen }]

    var dataforAbandonBars = [{"id": data[0].id, "unemployment": data[0].abandon, "sex": data[0].abandonWomen }, {"id": data[0].id, "unemployment": data[0].abandon,"sex": data[0].abandonMen }]

    var dataforNeetBars = [{"id": data[0].id, "unemployment": data[0].neet, "sex": data[0].neetWomen }, {"id": data[0].id, "unemployment": data[0].neet,"sex": data[0].neetMen }]

    var w = 200,
        h = 20;
 
    var x = d3.scale.linear()
        .domain([0, 55])
        .rangeRound([0, w]);
 
    var y = d3.scale.linear()
       .domain([0, 1])
       .range([0, h]);
    
    var unemplRegionBarChart = d3.select("#barchart")
        .style("position", "absolute")
        .style("top", "150px")
        .style("left", "600px")
        .select('#genderRegionUnemplBar')
        .attr("width", w)
        .attr("height", h*2)
    
    unemplRegionBarChart.selectAll("rect")
        .data(dataforUnemplBars)
        .transition()
        .duration(500)
        .attr("x", function (d) { return - 85 ; })
        .attr("y", function (d, i) { return - y(i) + 40; })
        .attr("width", function (d) { return x(d.sex); })
        .attr("height", h )

    var abandonRegionBarChart = d3.select("#barchart")
        .style("position", "absolute")
        .style("top", "150px")
        .style("left", "600px")
        .select('#genderRegionAbandonBar')
        .attr("width", w)
        .attr("height", h*2)
    
    abandonRegionBarChart.selectAll("rect")
        .data(dataforAbandonBars)
        .transition()
        .duration(500)
        .attr("x", function (d) { return - 85 ; })
        .attr("y", function (d, i) { return - y(i) + 40; })
        .attr("width", function (d) { return x(d.sex); })
        .attr("height", h )

    var neetRegionBarChart = d3.select("#barchart")
        .style("position", "absolute")
        .style("top", "150px")
        .style("left", "600px")
        .select('#genderRegionNeetBar')
        .attr("width", w)
        .attr("height", h*2)
    
    neetRegionBarChart.selectAll("rect")
        .data(dataforNeetBars)
        .transition()
        .duration(500)
        .attr("x", function (d) { return - 85 ; })
        .attr("y", function (d, i) { return - y(i) + 40; })
        .attr("width", function (d) { return x(d.sex); })
        .attr("height", h )
}

function moveOutRegion (data) {
    var w = 20,
        h = 150;
 
    var x = d3.scale.linear()
        .domain([0, 1])
        .range([0, w]);
 
    var y = d3.scale.linear()
       .domain([0, 100])
       .rangeRound([0, h]); 

    var unemplBarChart = d3.select("#barchart").select('#genderUnemplBar')
    unemplBarChart.selectAll('rect')
    .data([0,0]) 
    .transition()
    .duration(500)
    .attr("y", function(d) { return h - y(d) - .5; })
    .attr("height", function (d) { return d;});

    var abandonBarChart = d3.select("#barchart").select('#genderAbandonBar')
    abandonBarChart.selectAll('rect')
    .data([0,0]) 
    .transition()
    .duration(500)
    .attr("y", function(d) { return h - y(d) - .5; })
    .attr("height", function (d) { return d;});  


}

</script>